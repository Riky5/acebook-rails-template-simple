<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  <%= stylesheet_link_tag    'application', media: 'all' %>
</head>

<div class="container is-fluid">
  <div class="columns">
    <div class="column"></div>
      <div id="new-post" class="column is-half">

        <div class="container p-4" id="post-section">
          <div id="avatar" class="p-5"></div>
          <div id="post-link" class="container is-flex">
            <%= form_with(model: [ @post, Post.new ], local: true) do |form| %>
              <%= form.text_area :message, placeholder: "What's on your mind?", :class => "text-area-homepage" %>
              <div class="container is-flex">
                <%= form.file_field :image, class: "form-control" %>
                <%= form.submit "Post", class: "mt-4 mb-4" %>
              </div>
            <% end %>
          </div>
        </div>

        <% @posts.each do |post| %>
          <%= content_tag :div, id: dom_id(post) do %>
            <div class="container p-5" id="post-container">
              <div class="container post-card pt-4 pb-1 pl-4 pr-4">
                <div class="container" id="post-details">
                  <div id="avatar" class="p-5"></div>
                  <div class="container is-fluid">
                    <p id="user-name"><%= User.find(post.user_id).name %> <%= User.find(post.user_id).surname %></p>
                    <p id="created-at"><%= post.created_at %></p>
                  </div>
                </div>
                <div class="message-and-photo p-5">
                  <p class="mb-2"><%= post.message %></p>
                  <% if post.image.attached? %>
                    <%= image_tag post.image, class: "post-image"%>
                  <% end %>
                  <% if post.likes.count != 0 %>
                    <div class="container is-flex likes-count">
                      <p>
                        <i class="fas fa-thumbs-up"></i> <strong><%= post.likes.count %></strong>
                      </p>
                    </div>
                  <% end %>
                </div>
              </div>
            <div class="container is-flex likes-section">
              <% pre_like = post.likes.find { |like| like.user_id == current_user.id} %>
              <% if pre_like %>
                <%= button_to 'Unlike', post_like_path(post, pre_like), method: :delete, class: "m-2" %>
              <% else %>
                <%= button_to 'Like', post_likes_path(post), method: :post, class: "m-2" %>
              <% end %>
            </div>
              <div class="comments-section p-3">
                <% post.comments.each do |comment| %>
                  <div class="container individual-comment mb-3 p-2">
                    <p class="ml-4">
                      <strong>
                        <%= (User.find(comment.user_id)).name + " " + (User.find(comment.user_id)).surname %>
                      </strong>
                    </p>

                    <p class="ml-4">
                      <%= comment.body %>
                    </p>
                    <% if comment.image.attached? %>
                      <%= image_tag comment.image, class: "comment-image"%>
                    <% end %>
                  </div>
                <% end %>
                <div id="post-link" class="container is-flex comments-form">
                  <%= form_with(model: [ post, post.comments.build ], local: true) do |form| %>
                    <%= form.hidden_field :user_id, value: current_user.id %>  
                    <%= form.text_area :body, :class => "text-area-homepage" %>
                    <div class="container is-flex">
                    <%= form.file_field :image, class: "form-control" %>
                    <%= form.submit "Comment", class: "mt-4 mb-4" %>
                    </div>
                  <% end %>
                </div>
              </div>
           </div>   
          <% end %>
        <% end %>
      </div>
    <div class="column"></div>
  </div>
</div>